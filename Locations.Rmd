---
title: "locations~events"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(dbplyr)
library(rvest)
library(plotly)
```



```{r, include=FALSE}

park_event = read.csv("./park_events.csv") %>% 
  select(event_id, title, date,start_time, end_time, cost_free, must_see)
park_location = read.csv("./park_location.csv") %>% 
  select(event_id, name, park_id, lat, long, borough)

park_1 = left_join(park_event, park_location, by = "event_id") 
 
park_organizer = read.csv("./park_organizer.csv")
park_cate = read.csv("./park_cate.csv") %>% 
  rename(cate_name = name)

park_2  = left_join (park_cate, park_organizer, by = "event_id")


park_df = left_join (park_1, park_2,  by = "event_id")


```

### 5 most popular categories.

The 5 most held types of events in New York throughout the years. 

```{r, echo=FALSE}
park_df %>% 
  select(cate_name) %>% 
  group_by(cate_name) %>% 
  summarize(count = n()) %>% 
  arrange(desc(count)) %>% 
  head(5) %>% 
  knitr::kable()

```

From this table, we can see that "Best for kids" is the most popular category in New York City. It seems that people love to bring their kids to park events to relax. To find out the exact 5 most popular categories, we created a barplot showing the top 5 category distribution in each borough. 


```{r, echo=FALSE, message=FALSE}
## Most popular categories
B_df = 
  park_df %>% 
  group_by(borough, cate_name) %>% 
  summarize(count = n()) %>% 
  filter(borough == "B") %>% 
  arrange(desc(count)) %>% 
  head(5)

M_df = 
  park_df %>% 
  group_by(borough, cate_name) %>% 
  summarize(count = n()) %>% 
  filter(borough == "M") %>% 
  arrange(desc(count)) %>% 
  head(5)

Q_df = 
  park_df %>% 
  group_by(borough, cate_name) %>% 
  summarize(count = n()) %>% 
  filter(borough == "Q") %>% 
  arrange(desc(count)) %>% 
  head(5) 

R_df = 
  park_df %>% 
  group_by(borough, cate_name) %>% 
  summarize(count = n()) %>% 
  filter(borough == "R") %>% 
  arrange(desc(count)) %>% 
  head(5)

X_df = 
  park_df %>% 
  group_by(borough, cate_name) %>% 
  summarize(count = n()) %>% 
  filter(borough == "X") %>% 
  arrange(desc(count)) %>% 
  head(5)

first_df = rbind(M_df, B_df)
second_df = rbind(Q_df, R_df)
third_df = rbind(first_df, second_df)
whole_df = rbind(third_df, X_df)

whole_df %>% 
  mutate(borough = recode(borough, B = "Brooklyn", M = "Manhattan", Q = "Queens", R = "State Island", X = "Bronx")) %>% 
  ggplot(aes(x = borough, y = count, fill = cate_name)) +
  geom_bar(stat = "identity", position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +
  labs(title = "Most Popular Categories") +
  coord_flip()
```

Although Manhattan is the smallest borough, it is the most densely populated, so it is no surprise that Manhattan had the most events. The top 5 categories were fitness, nature, volunteer, best for kids and tours. The most popular categories in other boroughs were similar to those of Manhattan. However, art & crafts park events were higher in the popularity rank compared to their counterparts in Bronx, Queens, and Staten Island.  

```{r, echo=FALSE, message=FALSE}
## Most popular events
BB_df = 
  park_df %>% 
  group_by(borough, title) %>% 
  summarize(count = n()) %>% 
  filter(borough == "B") %>% 
  arrange(desc(count)) %>% 
  head(5)

MM_df = 
  park_df %>% 
  group_by(borough, title) %>% 
  summarize(count = n()) %>% 
  filter(borough == "M") %>% 
  arrange(desc(count)) %>% 
  head(5)

QQ_df = 
  park_df %>% 
  group_by(borough, title) %>% 
  summarize(count = n()) %>% 
  filter(borough == "Q") %>% 
  arrange(desc(count)) %>% 
  head(5) 

RR_df = 
  park_df %>% 
  group_by(borough, title) %>% 
  summarize(count = n()) %>% 
  filter(borough == "R") %>% 
  arrange(desc(count)) %>% 
  head(5)

XX_df = 
  park_df %>% 
  group_by(borough, title) %>% 
  summarize(count = n()) %>% 
  filter(borough == "X") %>% 
  arrange(desc(count)) %>% 
  head(5)

first1_df = rbind(MM_df, BB_df)
second1_df = rbind(QQ_df, RR_df)
third1_df = rbind(first1_df, second1_df)
whole1_df = rbind(third1_df, XX_df)

whole1_df %>% 
  mutate(borough = recode(borough, B = "Brooklyn", M = "Manhattan", Q = "Queens", R = "State Island", X = "Bronx")) %>%
  arrange(desc(count)) %>% 
  head(12) %>% 
  knitr::kable()
```

The most popular park event in Manhattan was "Morning Fitness at Fort Tryon Park," which is consistent with the No.1 popularity of fitness events. The same can be said of the other boroughs. The top events of the Bronx and Staten Island were about nature, pop culture, and mysteries from the past. Brooklyn apparently attached greater importance to education and teenager lives, making it a fantastic destination for kids and their parents. Lastly, the Queens did live up to its name, with "Leading the Way: Six Outstanding Women of Queens" as the most popular park event. 

```{r, echo=FALSE, message=FALSE}
## Most popular events
mustsee_df =
  park_df %>% 
  select(borough, must_see) %>% 
  filter(must_see == "1") %>% 
  mutate(borough = recode(borough, B = "Brooklyn", M = "Manhattan", Q = "Queens", R = "State Island", X = "Bronx")) %>%
  group_by(borough) %>% 
  summarize(count = n()) %>% 
  arrange(desc(count)) %>% 
  head(5)

mustsee_df %>% 
  knitr::kable()

mustsee_df %>% 
  ggplot(aes(x = borough, y = count)) +
  geom_bar(stat = "identity", position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +
  labs(title = "Must-see Events")
```

Obviously, Manhattan had the most must-see events given its world-renowned reputation and its numerous and diverse park events. 

```{r, echo=FALSE, message=FALSE}
costfree_df =
  park_df %>% 
  select(borough, cost_free) %>% 
  filter(cost_free == "1") %>% 
  mutate(borough = recode(borough, B = "Brooklyn", M = "Manhattan", Q = "Queens", R = "State Island", X = "Bronx")) %>%
  group_by(borough) %>% 
  summarize(count = n()) %>% 
  arrange(desc(count)) %>% 
  head(5)

noncostfree_df = 
  park_df %>% 
  select(borough, cost_free) %>% 
  filter(cost_free == "0") %>%  
  mutate(borough = recode(borough, B = "Brooklyn", M = "Manhattan", Q = "Queens", R = "State Island", X = "Bronx")) %>%
  group_by(borough) %>% 
  summarize(count = n()) %>% 
  arrange(desc(count)) %>% 
  head(5)

cost_df = left_join(costfree_df, noncostfree_df, by = "borough")

cost_df %>% 
  ggplot(aes(x = borough, y = count.x / (count.x+count.y))) +
  geom_bar(stat = "identity", position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +
  labs(title = "Proportions of Free Park Events",
  y = "Cost free / Total",
  x = "Borough")
```

We can see that Manhattan, Brooklyn, and Staten Island had the most free park events. In fact, nearly 90% of all three boroughs' park events were free. To sum up, visiting parks in Manhattan is the most cost-effective, as it had the highest number and diversity of parks as well as the highest ratio of free park events. 
